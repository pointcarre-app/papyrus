<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
          content="PCA Papyrus Auto-Print - Programmatic batch PDF generation for 4 JSON sources" />
    <meta name="keywords" content="PDF, math, LaTeX, KaTeX, document generation, batch printing, automation" />
    <title>PCA Papyrus - Auto Print (4 PDFs)</title>
    <link rel="stylesheet" href="../src/styles/index.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Spectral:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
          rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        .font-heading {
            font-family: 'Spectral', serif;
        }

        .font-body {
            font-family: 'Inter', sans-serif;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .auto-print-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 2rem;
        }

        .print-card {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a1a;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        .print-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 1rem 3rem;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .print-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.4);
        }

        .print-button:active {
            transform: translateY(0);
        }

        .print-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .status-indicator {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
        }

        .status-ready {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }

        .status-processing {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ff9800;
        }

        .status-complete {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #2196f3;
        }

        .json-sources-list {
            text-align: left;
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .json-source-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        }

        .json-source-item:last-child {
            border-bottom: none;
        }

        .source-status {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .source-loaded {
            background: #d4edda;
            color: #155724;
        }

        .source-error {
            background: #f8d7da;
            color: #721c24;
        }

        /* Hidden elements for multi-JSON functionality */
        #pages-container,
        #statistics-container,
        .json-textarea-container {
            display: none !important;
        }
    </style>

    <script>
        window.process = {
            env: {
                NODE_ENV: 'production'
            }
        };
    </script>
  </head>

  <body class="font-body">
    <div class="auto-print-container">
      <div class="print-card">
        <h1 class="font-heading text-3xl font-bold mb-4">PCA Papyrus Auto-Print</h1>

        <p class="text-lg mb-6 text-gray-600">
          Programmatic batch PDF generation for mathematical content
        </p>

        <div class="json-sources-list">
          <h3 class="font-heading font-semibold mb-3">Pre-loaded JSON Sources:</h3>
          <div class="json-source-item">
            <span>üìÑ Math Exam Version A</span>
            <span id="status-1" class="source-status source-loaded">Loaded</span>
          </div>
          <div class="json-source-item">
            <span>üìÑ Math Exam Version B</span>
            <span id="status-2" class="source-status source-loaded">Loaded</span>
          </div>
          <div class="json-source-item">
            <span>üìÑ Math Exam Version C</span>
            <span id="status-3" class="source-status source-loaded">Loaded</span>
          </div>
          <div class="json-source-item">
            <span>üìÑ Math Exam Version D</span>
            <span id="status-4" class="source-status source-loaded">Loaded</span>
          </div>
        </div>

        <button id="auto-print-button" class="print-button" onclick="executeAutoPrint()">
          üñ®Ô∏è Generate & Print All PDFs
        </button>

        <div id="status-indicator" class="status-indicator status-ready">‚úÖ Ready to print 4 PDFs</div>

        <div class="mt-6 text-sm text-gray-500">
          <p>‚Ä¢ No preview interface - direct to print</p>
          <p>‚Ä¢ All 4 JSON sources will be processed automatically</p>
          <p>‚Ä¢ Unified formatting applied to all documents</p>
          <p>‚Ä¢ Page breaks automatically inserted between PDFs</p>
        </div>

        <div class="mt-4">
          <a href="./multi-index.html" class="text-blue-500 hover:underline text-sm">
            ‚Üê Back to Multi-PDF Interface
          </a>
        </div>
      </div>
    </div>

    <!-- Hidden multi-JSON infrastructure -->
    <div style="display: none;">
      <div id="pages-container"></div>
      <div id="statistics-container"></div>
      <div id="pagination-container"></div>

      <!-- JSON textarea containers (hidden) -->
      <div id="json-textareas-container">
        <div class="json-textarea-container active" data-json-id="1">
          <textarea id="json-input-1"></textarea>
        </div>
        <div class="json-textarea-container" data-json-id="2">
          <textarea id="json-input-2"></textarea>
        </div>
        <div class="json-textarea-container" data-json-id="3">
          <textarea id="json-input-3"></textarea>
        </div>
        <div class="json-textarea-container" data-json-id="4">
          <textarea id="json-input-4"></textarea>
        </div>
      </div>

      <!-- JSON tabs container (hidden) -->
      <div id="json-tabs-container">
        <div class="json-tab active" data-json-id="1">JSON #1</div>
        <div class="json-tab" data-json-id="2">JSON #2</div>
        <div class="json-tab" data-json-id="3">JSON #3</div>
        <div class="json-tab" data-json-id="4">JSON #4</div>
      </div>

      <!-- Settings forms (hidden but functional) -->
      <form id="margin-form">
        <input name="margin-top" value="5" />
        <input name="margin-right" value="5" />
        <input name="margin-bottom" value="5" />
        <input name="margin-left" value="5" />
        <input name="space-between-divs" value="3" />
      </form>

      <form id="font-form">
        <input name="font-h1" value="32" />
        <input name="font-h2" value="28" />
        <input name="font-h3" value="24" />
        <input name="font-h4" value="20" />
        <input name="font-h5" value="18" />
        <input name="font-h6" value="16" />
        <input name="font-body" value="14" />
      </form>

      <input type="checkbox" id="debug-mode" />
      <input type="checkbox" id="show-page-numbers" />
    </div>

    <!-- Load the multi-JSON engine -->
    <script type="module" src="../src/core/multi-app-init.js"></script>

    <!-- Auto-print specific functionality -->
    <script>
        // Sample JSON content for the 4 sources
        const sampleJSONSources = [
            // Math Exam Version A
            [{
                "id": "header-a",
                "html": "<table style='width: 100%; border-collapse: collapse; border: 1px solid #000;'><tr><td style='border: 1px solid #000; padding: 8px;'>Name: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Class: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Date: _______________</td></tr></table>",
                "classes": [],
                "style": "",
                "isPapyrusHeader": true
            }, {
                "id": "title-a",
                "html": "<h1 style='text-align: center; margin: 20px 0;'>Mathematics Exam - Version A</h1>",
                "classes": [],
                "style": ""
            }, {
                "id": "problem-a1",
                "html": "<div><strong>1.</strong> Solve for x: $3x + 7 = 22$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-a2",
                "html": "<div><strong>2.</strong> Find the derivative: $\\frac{d}{dx}[x^3 + 2x^2 - 5x + 1]$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-a3",
                "html": "<div><strong>3.</strong> Evaluate the integral: $$\\int_{0}^{2} (x^2 + 1) dx$$</div>",
                "classes": [],
                "style": "margin: 20px 0; text-align: center;"
            }],

            // Math Exam Version B  
            [{
                "id": "header-b",
                "html": "<table style='width: 100%; border-collapse: collapse; border: 1px solid #000;'><tr><td style='border: 1px solid #000; padding: 8px;'>Name: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Class: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Date: _______________</td></tr></table>",
                "classes": [],
                "style": "",
                "isPapyrusHeader": true
            }, {
                "id": "title-b",
                "html": "<h1 style='text-align: center; margin: 20px 0;'>Mathematics Exam - Version B</h1>",
                "classes": [],
                "style": ""
            }, {
                "id": "problem-b1",
                "html": "<div><strong>1.</strong> Solve for x: $2x - 5 = 13$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-b2",
                "html": "<div><strong>2.</strong> Find the derivative: $\\frac{d}{dx}[2x^3 - x^2 + 4x - 3]$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-b3",
                "html": "<div><strong>3.</strong> Evaluate the integral: $$\\int_{1}^{3} (2x + 3) dx$$</div>",
                "classes": [],
                "style": "margin: 20px 0; text-align: center;"
            }],

            // Math Exam Version C
            [{
                "id": "header-c",
                "html": "<table style='width: 100%; border-collapse: collapse; border: 1px solid #000;'><tr><td style='border: 1px solid #000; padding: 8px;'>Name: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Class: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Date: _______________</td></tr></table>",
                "classes": [],
                "style": "",
                "isPapyrusHeader": true
            }, {
                "id": "title-c",
                "html": "<h1 style='text-align: center; margin: 20px 0;'>Mathematics Exam - Version C</h1>",
                "classes": [],
                "style": ""
            }, {
                "id": "problem-c1",
                "html": "<div><strong>1.</strong> Solve for x: $5x - 8 = 27$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-c2",
                "html": "<div><strong>2.</strong> Find the derivative: $\\frac{d}{dx}[x^4 - 3x^3 + 2x - 7]$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-c3",
                "html": "<div><strong>3.</strong> Evaluate the integral: $$\\int_{0}^{1} (3x^2 - x + 2) dx$$</div>",
                "classes": [],
                "style": "margin: 20px 0; text-align: center;"
            }],

            // Math Exam Version D
            [{
                "id": "header-d",
                "html": "<table style='width: 100%; border-collapse: collapse; border: 1px solid #000;'><tr><td style='border: 1px solid #000; padding: 8px;'>Name: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Class: _______________</td><td style='border: 1px solid #000; padding: 8px;'>Date: _______________</td></tr></table>",
                "classes": [],
                "style": "",
                "isPapyrusHeader": true
            }, {
                "id": "title-d",
                "html": "<h1 style='text-align: center; margin: 20px 0;'>Mathematics Exam - Version D</h1>",
                "classes": [],
                "style": ""
            }, {
                "id": "problem-d1",
                "html": "<div><strong>1.</strong> Solve for x: $4x + 3 = 19$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-d2",
                "html": "<div><strong>2.</strong> Find the derivative: $\\frac{d}{dx}[x^5 + x^4 - 2x^2 + x]$</div>",
                "classes": [],
                "style": "margin: 15px 0;"
            }, {
                "id": "problem-d3",
                "html": "<div><strong>3.</strong> Evaluate the integral: $$\\int_{-1}^{2} (x^3 + 2x) dx$$</div>",
                "classes": [],
                "style": "margin: 20px 0; text-align: center;"
            }]
        ];

        // Initialize auto-print functionality
        function initializeAutoPrint() {
            // Wait for multi-JSON manager to be ready
            setTimeout(() => {
                if (window.multiJSONManager) {
                    loadAllJSONSources();
                } else {
                    // Retry if not ready yet
                    setTimeout(initializeAutoPrint, 500);
                }
            }, 100);
        }

        // Load all 4 JSON sources
        function loadAllJSONSources() {
            try {
                // Add 3 more JSON tabs (1 already exists)
                for (let i = 2; i <= 4; i++) {
                    window.addNewJSON();
                }

                // Load content into each tab
                sampleJSONSources.forEach((jsonData, index) => {
                    const jsonId = index + 1;
                    window.switchToJSON(jsonId);

                    const textarea = document.getElementById(`json-input-${jsonId}`);
                    if (textarea) {
                        textarea.value = JSON.stringify(jsonData, null, 2);

                        // Save to manager
                        const set = window.multiJSONManager.jsonSets.get(jsonId);
                        if (set) {
                            set.content = textarea.value;
                        }
                    }

                    console.log(`‚úÖ Loaded JSON source ${jsonId}`);
                });

                updateStatusIndicator('ready', '‚úÖ All 4 JSON sources loaded and ready');

            } catch (error) {
                console.error('Error loading JSON sources:', error);
                updateStatusIndicator('error', '‚ùå Error loading JSON sources');
            }
        }

        // Execute the auto-print process
        function executeAutoPrint() {
            const button = document.getElementById('auto-print-button');
            button.disabled = true;

            updateStatusIndicator('processing', '‚è≥ Generating PDFs...');

            try {
                // Generate all previews
                window.generateAllPreviews();

                // Wait for generation to complete, then print
                setTimeout(() => {
                    updateStatusIndicator('processing', 'üñ®Ô∏è Opening print dialog...');

                    setTimeout(() => {
                        window.printAllPDFs();
                        updateStatusIndicator('complete', '‚úÖ Print dialog opened');

                        // Re-enable button after a delay
                        setTimeout(() => {
                            button.disabled = false;
                            updateStatusIndicator('ready', '‚úÖ Ready to print again');
                        }, 3000);
                    }, 1000);
                }, 2000);

            } catch (error) {
                console.error('Error in auto-print:', error);
                updateStatusIndicator('error', '‚ùå Error during printing process');
                button.disabled = false;
            }
        }

        // Update status indicator
        function updateStatusIndicator(status, message) {
            const indicator = document.getElementById('status-indicator');
            indicator.className = `status-indicator status-${status}`;
            indicator.textContent = message;
        }

        // Make functions globally available
        window.executeAutoPrint = executeAutoPrint;

        // Initialize when page loads
        window.addEventListener('load', initializeAutoPrint);
    </script>
  </body>
</html>
